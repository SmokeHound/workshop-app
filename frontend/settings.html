<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Site Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/styles.css" rel="stylesheet" />
</head>
<body>
  <div id="nav-placeholder"></div>
  <main class="container" style="margin-left: 270px; padding-top: 20px; max-width: 600px;">
    <h1>Site Settings</h1>
    <form id="settings-form" class="card p-4 shadow-sm bg-white">
      <div class="mb-3">
        <label for="theme" class="form-label">Theme</label>
        <select id="theme" class="form-select">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="apiBase" class="form-label">API Base URL</label>
        <input type="text" id="apiBase" class="form-control" />
      </div>
      <div class="mb-3">
        <label for="notifications" class="form-label">Enable Notifications</label>
        <select id="notifications" class="form-select">
          <option value="on">On</option>
          <option value="off">Off</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="defaultPage" class="form-label">Default Page After Login</label>
        <select id="defaultPage" class="form-select">
          <option value="index.html">Home</option>
          <option value="order.html">Order</option>
          <option value="history.html">History</option>
          <option value="item-admin.html">Item Admin</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="fontSize" class="form-label">Font Size</label>
        <select id="fontSize" class="form-select">
          <option value="small">Small</option>
          <option value="medium">Medium</option>
          <option value="large">Large</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="accessibility" class="form-label">Accessibility Options</label>
        <select id="accessibility" class="form-select">
          <option value="normal">Normal</option>
          <option value="high-contrast">High Contrast</option>
        </select>
      </div>
      <button class="btn btn-primary" type="submit">Save Settings</button>
    </form>
    <div id="settings-result" class="mt-3 text-success fw-bold" style="display:none;"></div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    import { showToast } from './utils.js';
    // Load saved settings
    const themeSelect = document.getElementById('theme');
    const apiBaseInput = document.getElementById('apiBase');
    const notificationsSelect = document.getElementById('notifications');
    const defaultPageSelect = document.getElementById('defaultPage');
    const fontSizeSelect = document.getElementById('fontSize');
    const accessibilitySelect = document.getElementById('accessibility');
    const resultEl = document.getElementById('settings-result');

    themeSelect.value = localStorage.getItem('siteTheme') || 'light';
    apiBaseInput.value = localStorage.getItem('API_BASE') || '';
    notificationsSelect.value = localStorage.getItem('notifications') || 'on';
    defaultPageSelect.value = localStorage.getItem('defaultPage') || 'index.html';
    fontSizeSelect.value = localStorage.getItem('fontSize') || 'medium';
    accessibilitySelect.value = localStorage.getItem('accessibility') || 'normal';

    // Save settings
    document.getElementById('settings-form').onsubmit = e => {
      e.preventDefault();
      localStorage.setItem('siteTheme', themeSelect.value);
      localStorage.setItem('API_BASE', apiBaseInput.value.trim());
      localStorage.setItem('notifications', notificationsSelect.value);
      localStorage.setItem('defaultPage', defaultPageSelect.value);
      localStorage.setItem('fontSize', fontSizeSelect.value);
      localStorage.setItem('accessibility', accessibilitySelect.value);
      resultEl.textContent = 'Settings saved!';
      resultEl.style.display = 'block';
      showToast('Settings updated.', 'success');
      setTimeout(() => resultEl.style.display = 'none', 2000);
      // Apply settings immediately
      document.documentElement.setAttribute('data-theme', themeSelect.value);
      document.body.style.fontSize = fontSizeSelect.value === 'small' ? '14px' : fontSizeSelect.value === 'large' ? '20px' : '16px';
      if (accessibilitySelect.value === 'high-contrast') {
        document.body.classList.add('high-contrast');
      } else {
        document.body.classList.remove('high-contrast');
      }
    };
    // Apply theme and font size immediately
    themeSelect.onchange = () => {
      document.documentElement.setAttribute('data-theme', themeSelect.value);
    };
    fontSizeSelect.onchange = () => {
      document.body.style.fontSize = fontSizeSelect.value === 'small' ? '14px' : fontSizeSelect.value === 'large' ? '20px' : '16px';
    };
    accessibilitySelect.onchange = () => {
      if (accessibilitySelect.value === 'high-contrast') {
        document.body.classList.add('high-contrast');
      } else {
        document.body.classList.remove('high-contrast');
      }
    };

  // Nav loader script
    async function loadNav() {
      try {
        const res = await fetch('nav.html');
        const html = await res.text();
  const navPlaceholder = document.getElementById('nav-placeholder');
  navPlaceholder.textContent = '';
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = html;
  Array.from(tempDiv.childNodes).forEach(node => navPlaceholder.appendChild(node));
      } catch (err) {
        console.error('Failed to load nav:', err);
        showToast('Failed to load navigation.', 'danger');
      }
    }

    if (document.readyState === 'loading') {
      window.addEventListener('DOMContentLoaded', loadNav, { once: true });
    } else {
      loadNav();
    }
  </script>
</body>
</html>
